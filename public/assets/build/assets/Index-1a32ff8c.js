import{r as n,f as e,j as s,m as C,F as z,o as q,t as D}from"./index-da73a707.js";import{u as j,P}from"./main-fa059dc7.js";import{b as L}from"./index-265e33c3.js";import{q as w,_ as T,S as U}from"./index-0aa609d0.js";function I({modal:m,setModal:d,script:i,fetchScripts:g}){const{logout:h,crmToken:x,apiUrl:N}=j(),f={id:"",name:"",script:"",status:1},[r,b]=n.useState(f),[c,o]=n.useState({}),[v,t]=n.useState(!1);n.useEffect(()=>{m&&(b(i?{id:i.id,name:i.name,script:i.script,status:i.status?1:0}:f),o({}))},[m,i]);const S=()=>{const a={};return r.name||(a.name="Name is required"),r.script||(a.script="Script is required"),o(a),Object.keys(a).length===0},p=a=>{const{name:u,value:y}=a.target;b(l=>({...l,[u]:y})),o(l=>({...l,[u]:""}))},$=a=>{a.data.status==="success"?(d(!1),g()):alert("Failed")},B=async a=>{var u,y;t(!0);try{const l=await C.post(`${N}/api/scripts`,a,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${x}`}});$(l)}catch(l){if(((u=l.response)==null?void 0:u.status)===401&&h(),((y=l.response)==null?void 0:y.status)===422){const F=l.response.data.errors,A={};for(const E in F)A[E]=F[E][0];o(A)}}finally{t(!1)}},k=()=>{if(!S())return;const a=new FormData;a.append("id",r.id),a.append("name",r.name),a.append("script",r.script),a.append("status",String(r.status)),B(a)};return e(w,{appear:!0,show:m,as:n.Fragment,children:s(T,{as:"div",open:m,onClose:()=>d(!1),children:[e(w.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0"})}),e("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[999]",children:e("div",{className:"flex items-start justify-center min-h-screen px-4",children:e(w.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:s(T.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-5xl my-8 text-black dark:text-white-dark",children:[s("div",{className:"flex bg-[#fbfbfb] dark:bg-[#121c2c] items-center justify-between px-5 py-3",children:[s("h5",{className:"font-bold text-lg",children:[r!=null&&r.id?"Update":"Add"," Scripts"]}),e("button",{onClick:()=>d(!1),type:"button","aria-label":"Close modal",className:"text-white-dark hover:text-dark",children:e(L,{size:30,color:"red"})})]}),e("div",{className:"p-5",children:s("form",{className:"space-y-5",onSubmit:a=>{a.preventDefault(),k()},children:[s("div",{children:[e("label",{htmlFor:"name",children:"Script Name"}),e("input",{type:"text",placeholder:"Enter Script Name",className:"form-input",name:"name",value:r.name,onChange:p,required:!0}),c.name&&e("div",{className:"text-danger mt-1",children:c.name})]}),s("div",{children:[e("label",{htmlFor:"status",children:"Status"}),s("select",{className:"form-select text-white-dark",name:"status",value:r.status,onChange:p,children:[e("option",{value:1,children:"Active"}),e("option",{value:0,children:"Blocked"})]}),c.status&&e("div",{className:"text-danger mt-1",children:c.status})]}),s("div",{children:[e("label",{htmlFor:"script",children:"Script"}),e("textarea",{rows:10,className:"form-textarea",placeholder:"Enter Script",name:"script",value:r.script,onChange:p,required:!0}),c.script&&e("div",{className:"text-danger mt-1",children:c.script})]}),e("div",{className:"flex justify-end items-center mt-8",children:e("button",{type:"button",onClick:k,disabled:v,className:"btn btn-primary",children:v?"Please Wait...":r.id?"Update Script":"Add Script"})})]})})]})})})})]})})}function V(){const{logout:m,crmToken:d,apiUrl:i}=j(),[g,h]=n.useState(!0),[x,N]=n.useState([]),[f,r]=n.useState(!1),[b,c]=n.useState(null),o=async()=>{h(!0);try{const t=await C.get(`${i}/api/scripts`,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${d}`}});t.data.status==="success"?N(t.data.scripts):console.error("Failed to fetch scripts")}catch(t){console.error("Error fetching scripts:",t)}finally{h(!1)}};n.useEffect(()=>{o()},[]);const v=t=>{U.fire({icon:"warning",title:"Are you sure?",text:"You won't be able to revert this!",showCancelButton:!0,confirmButtonText:"Delete",padding:"2em",customClass:"sweet-alerts"}).then(async S=>{if(S.isConfirmed)try{(await C.delete(`${i}/api/scripts/${t.id}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}})).data.status==="success"?o():console.error("Failed to delete script")}catch(p){console.error("Error deleting script:",p)}})};return s(z,{children:[s("div",{className:"panel",children:[s("div",{className:"flex justify-between mb-4",children:[e("h1",{className:"font-extrabold text-[18px]",children:"Scripts & Meta Tags"}),e("button",{className:"btn btn-gradient",onClick:()=>{c(null),r(!0)},children:"Add Script"})]}),g?e(P,{}):e("div",{className:"table-responsive mb-5",children:s("table",{children:[e("thead",{children:s("tr",{children:[e("th",{children:"Name"}),e("th",{children:"Status"}),e("th",{children:"Script"}),e("th",{className:"text-end",children:"Action"})]})}),e("tbody",{children:x.map(t=>s("tr",{children:[e("td",{children:e("div",{className:"whitespace-nowrap",children:t.name})}),e("td",{children:t.status===1?"Active":"Blocked"}),e("td",{children:t.script}),e("td",{className:"text-end",children:s("div",{className:"flex gap-3 justify-end",children:[e("button",{onClick:()=>{c(t),r(!0)},"aria-label":`Edit ${t.name}`,children:e(q,{size:20,color:"orange"})}),e("button",{onClick:()=>v(t),"aria-label":`Delete ${t.name}`,children:e(D,{color:"red",size:20})})]})})]},t.id))})]})})]}),e(I,{modal:f,setModal:r,fetchScripts:o,script:b})]})}export{V as default};
